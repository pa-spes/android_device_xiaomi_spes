From 46276f0663442e6d72f0148bd33aff0adaad07fa Mon Sep 17 00:00:00 2001
From: Arian <arian.kulmer@web.de>
Date: Wed, 28 Feb 2024 11:41:22 +0100
Subject: [PATCH 2/3] ims: Remove MIUI dependencies

---
 ...essionImpl$ImsCallSessionImplHandler.smali |   2 -
 .../codeaurora/ims/ImsCallSessionImpl.smali   |   2 -
 smali/org/codeaurora/ims/ImsSenderRxr.smali   | 137 +-----------------
 .../ims/ImsServiceStateReceiver.smali         |  11 --
 .../org/codeaurora/ims/ImsSubController.smali |  14 --
 5 files changed, 1 insertion(+), 165 deletions(-)

diff --git a/smali/org/codeaurora/ims/ImsCallSessionImpl$ImsCallSessionImplHandler.smali b/smali/org/codeaurora/ims/ImsCallSessionImpl$ImsCallSessionImplHandler.smali
index 90b2517..4fc87cc 100644
--- a/smali/org/codeaurora/ims/ImsCallSessionImpl$ImsCallSessionImplHandler.smali
+++ b/smali/org/codeaurora/ims/ImsCallSessionImpl$ImsCallSessionImplHandler.smali
@@ -1089,8 +1089,6 @@
 
     const/4 v4, 0x6
 
-    invoke-virtual {v2, v3, v1, v4}, Lorg/codeaurora/ims/ImsSenderRxr;->synchronizeMessage(Ljava/lang/String;II)V
-
     .line 1043
     goto/16 :goto_2
 
diff --git a/smali/org/codeaurora/ims/ImsCallSessionImpl.smali b/smali/org/codeaurora/ims/ImsCallSessionImpl.smali
index c6c6b1d..e49853e 100644
--- a/smali/org/codeaurora/ims/ImsCallSessionImpl.smali
+++ b/smali/org/codeaurora/ims/ImsCallSessionImpl.smali
@@ -10894,8 +10894,6 @@
 
     const/4 v4, 0x6
 
-    invoke-virtual {v2, v3, v4, v1}, Lorg/codeaurora/ims/ImsSenderRxr;->synchronizeMessage(Ljava/lang/String;II)V
-
     goto/16 :goto_3
 
     .line 464
diff --git a/smali/org/codeaurora/ims/ImsSenderRxr.smali b/smali/org/codeaurora/ims/ImsSenderRxr.smali
index 7b85d01..baa18ae 100644
--- a/smali/org/codeaurora/ims/ImsSenderRxr.smali
+++ b/smali/org/codeaurora/ims/ImsSenderRxr.smali
@@ -6184,21 +6184,8 @@
     .line 1691
     return-void
 
-    .line 1695
-    :cond_0
-    if-nez p4, :cond_1
-
-    .line 1696
-    invoke-static/range {p1 .. p1}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
-
-    move-result-object v6
-
-    const/4 v7, 0x0
-
-    invoke-virtual {p0, v6, v7, v0}, Lorg/codeaurora/ims/ImsSenderRxr;->synchronizeMessage(Ljava/lang/String;II)V
-
     .line 1698
-    :cond_1
+    :cond_0
     invoke-direct {p0, v5}, Lorg/codeaurora/ims/ImsSenderRxr;->queueRequest(Lorg/codeaurora/ims/IFRequest;)V
 
     .line 1700
@@ -11739,128 +11726,6 @@
     return-void
 .end method
 
-.method public synchronizeMessage(Ljava/lang/String;II)V
-    .locals 3
-    .param p1, "callId"    # Ljava/lang/String;
-    .param p2, "callState"    # I
-    .param p3, "commandState"    # I
-
-    .line 2740
-    new-instance v0, Landroid/content/Intent;
-
-    invoke-direct {v0}, Landroid/content/Intent;-><init>()V
-
-    .line 2741
-    .local v0, "intent":Landroid/content/Intent;
-    const-string v1, "com.android.phone"
-
-    invoke-virtual {v0, v1}, Landroid/content/Intent;->setPackage(Ljava/lang/String;)Landroid/content/Intent;
-
-    .line 2742
-    if-eqz p2, :cond_0
-
-    .line 2743
-    const-string v1, "miui.intent.action.CALL_STATE"
-
-    invoke-virtual {v0, v1}, Landroid/content/Intent;->setAction(Ljava/lang/String;)Landroid/content/Intent;
-
-    .line 2744
-    const-string v1, "miui.intent.extra.call_state"
-
-    invoke-virtual {v0, v1, p2}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;
-
-    goto :goto_0
-
-    .line 2745
-    :cond_0
-    if-eqz p3, :cond_1
-
-    .line 2746
-    const-string v1, "miui.intent.action.USER_COMMAND_STATE"
-
-    invoke-virtual {v0, v1}, Landroid/content/Intent;->setAction(Ljava/lang/String;)Landroid/content/Intent;
-
-    .line 2747
-    const-string v1, "miui.intent.extra.command_state"
-
-    invoke-virtual {v0, v1, p3}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;
-
-    .line 2749
-    :cond_1
-    :goto_0
-    new-instance v1, Ljava/lang/StringBuilder;
-
-    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
-
-    const-string v2, "synchronizeMessage: callId: "
-
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    const-string v2, " callstate: "
-
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    invoke-virtual {v1, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    const-string v2, " commandState: "
-
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    invoke-virtual {v1, p3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    const-string v2, " mPhoneId: "
-
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    iget-object v2, p0, Lorg/codeaurora/ims/ImsSenderRxr;->mPhoneId:Ljava/lang/Integer;
-
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
-
-    move-result-object v1
-
-    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v1
-
-    invoke-static {p0, v1}, Lcom/qualcomm/ims/utils/Log;->i(Ljava/lang/Object;Ljava/lang/String;)V
-
-    .line 2751
-    const-string v1, "miui.intent.extra.call_id"
-
-    invoke-virtual {v0, v1, p1}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
-
-    .line 2752
-    iget-object v1, p0, Lorg/codeaurora/ims/ImsSenderRxr;->mPhoneId:Ljava/lang/Integer;
-
-    const-string v2, "miui.intent.extra.call_phoneid"
-
-    invoke-virtual {v0, v2, v1}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Ljava/io/Serializable;)Landroid/content/Intent;
-
-    .line 2753
-    iget-object v1, p0, Lorg/codeaurora/ims/ImsSenderRxr;->mContext:Landroid/content/Context;
-
-    invoke-virtual {v1, v0}, Landroid/content/Context;->sendBroadcast(Landroid/content/Intent;)V
-
-    .line 2754
-    return-void
-.end method
-
 .method public unRegisterForWfcRoamingModeFeatureSupport(Landroid/os/Handler;)V
     .locals 1
     .param p1, "h"    # Landroid/os/Handler;
diff --git a/smali/org/codeaurora/ims/ImsServiceStateReceiver.smali b/smali/org/codeaurora/ims/ImsServiceStateReceiver.smali
index e59671e..fb4721b 100644
--- a/smali/org/codeaurora/ims/ImsServiceStateReceiver.smali
+++ b/smali/org/codeaurora/ims/ImsServiceStateReceiver.smali
@@ -877,18 +877,7 @@
     .param p1, "isVideoCapable"    # Z
     .param p2, "isVoiceCapable"    # Z
 
-    .line 68
-    invoke-static {}, Landroid/telephony/TelephonyBaseUtilsStub;->isMiuiRom()Z
-
-    move-result v0
-
-    if-eqz v0, :cond_0
-
-    .line 69
-    return-void
-
     .line 72
-    :cond_0
     new-instance v0, Ljava/lang/StringBuilder;
 
     invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V
diff --git a/smali/org/codeaurora/ims/ImsSubController.smali b/smali/org/codeaurora/ims/ImsSubController.smali
index f398760..e926d1e 100644
--- a/smali/org/codeaurora/ims/ImsSubController.smali
+++ b/smali/org/codeaurora/ims/ImsSubController.smali
@@ -921,13 +921,6 @@
     .line 490
     if-nez p1, :cond_2
 
-    .line 492
-    invoke-static {}, Landroid/telephony/TelephonyBaseUtilsStub;->isMiuiRom()Z
-
-    move-result v1
-
-    if-eqz v1, :cond_2
-
     .line 493
     iget-object v1, p0, Lorg/codeaurora/ims/ImsSubController;->mHandler:Landroid/os/Handler;
 
@@ -1834,13 +1827,6 @@
     .line 530
     if-eqz v2, :cond_6
 
-    .line 532
-    invoke-static {}, Landroid/telephony/TelephonyBaseUtilsStub;->isMiuiRom()Z
-
-    move-result v1
-
-    if-eqz v1, :cond_6
-
     .line 533
     iget-object v1, p0, Lorg/codeaurora/ims/ImsSubController;->mHandler:Landroid/os/Handler;
 
-- 
2.46.0

